#!/bin/sh
set -e

set -x # Log every command
echo "[POSTINST] Start at $(date)"

mkdir -p /usr/share/baux && echo "[OK] Created /usr/share/baux" || {
  echo "[ERROR] mkdir baux failed"
  exit 1
}
chown root:root /usr/share/baux && echo "[OK] chown baux" || {
  echo "[ERROR] chown failed"
  exit 1
}
chmod 755 /usr/share/baux && echo "[OK] chmod baux" || {
  echo "[ERROR] chmod failed"
  exit 1
}

mkdir -p /usr/share/tmux-plugins && echo "[OK] Created tmux-plugins" || {
  echo "[ERROR] mkdir tmux-plugins failed"
  exit 1
}

# Runtime update plugins if newer (idempotent, logs)
for repo in resurrect continuum; do
  dir="/usr/share/tmux-plugins/$repo"
  if [ -d "$dir" ]; then
    echo "[UPDATE] Pulling $repo"
    git -C "$dir" pull -q && echo "[OK] $repo updated" || echo "[WARN] $repo pull failed, keeping local"
  else
    echo "[WARN] $repo dir missing â€” skipping (should be in package)"
  fi
done

[ -f /usr/share/baux/bauxrc ] && chmod 644 /usr/share/baux/bauxrc && echo "[OK] chmod bauxrc" || echo "[WARN] bauxrc not found"

echo "[POSTINST] Complete at $(date)"
exit 0
